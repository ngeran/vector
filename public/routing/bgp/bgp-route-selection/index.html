<!DOCTYPE html>
<html lang="en-us" dir="ltr" class="scroll-smooth">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
<meta name="robots" content="noindex, nofollow" />
<title>
Route Selection | ngeran[io]
</title>

    <link rel="stylesheet" href="/css/styles.css">


      <script src="/js/main.js"></script>


</head>
<body class="flex flex-col h-screen px-6 m-auto leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-gray-900 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <header>
    <div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <nav class="relative max-w-[64rem] ml-auto mr-auto top-3 p-4  lg:px-8  lg:py-3 shadow-lg bg-[#d8dee9] bg-opacity-10 backdrop-blur-lg backdrop-saturate-150 z-50 rounded-2xl  ">
    <div class="mx-auto flex items-center justify-between">
      
      <div class=" text-xl ">
       <a href="/" class="text-xl" ><span class="text-[#eceff4] ">ngeran</span><span class="text-[#81a1c1]">[</span><span class="text-[#ebcb8b]">io</span><span class="text-[#81a1c1]">]</span>
        </a>
      </div>
  
      
      <div class="hidden lg:flex space-x-6 ">
        
          <div class="relative group">
            <a href="/" class=" text-[#d8dee9] hover:text-[#ebcb8b] h-full">home</a>
            
            
          </div>
        
          <div class="relative group">
            <a href="" class=" text-[#d8dee9] hover:text-[#ebcb8b] h-full">posts</a>
            
            
 
              <div class="absolute  left-0 hidden p-4 mt-0 space-y-2 bg-gray-700  group-hover:block rounded-md bg-opacity-10 backdrop-blur-lg">
                
                  <div>
                    <a href="/routing/bgp/" class="text-[#d8dee9] hover:text-[#ebcb8b]">bgp</a>
                  </div>
                
                  <div>
                    <a href="/routing/ospf/" class="text-[#d8dee9] hover:text-[#ebcb8b]">o.s.p.f</a>
                  </div>
                
              </div>
            
          </div>
        
          <div class="relative group">
            <a href="" class=" text-[#d8dee9] hover:text-[#ebcb8b] h-full">projects</a>
            
            
          </div>
        
      </div>
  
      
      <div class="lg:hidden">
        <button id="hamburger" class="block text-[#5e81ac] focus:outline-none">
          <div class="w-6 h-0.5 bg-white mb-1 transition-all duration-300" id="bar1"></div>
          <div class="w-6 h-0.5 bg-white mb-1 transition-all duration-300" id="bar2"></div>
          <div class="w-6 h-0.5 bg-white transition-all duration-300" id="bar3"></div>
        </button>
      </div>
    </div>
  
    
    <div id="mobileMenu" class="lg:hidden hidden bg-gray-800">
      <div class="p-4">
        
          <div class="relative group">
            <a href="/" class="block py-2 px-4 text-[#5e81ac] hover:bg-gray-700 rounded">home</a>
  
            
          </div>
        
          <div class="relative group">
            <a href="" class="block py-2 px-4 text-[#5e81ac] hover:bg-gray-700 rounded">posts</a>
  
            
              <div class="hidden mt-2 space-y-2 bg-gray-700 p-4 group-hover:block">
                
                  <div>
                    <a href="/routing/bgp/" class="block py-2 px-4 text-[#5e81ac] hover:bg-gray-600 rounded">bgp</a>
                  </div>
                
                  <div>
                    <a href="/routing/ospf/" class="block py-2 px-4 text-[#5e81ac] hover:bg-gray-600 rounded">o.s.p.f</a>
                  </div>
                
              </div>
            
          </div>
        
          <div class="relative group">
            <a href="" class="block py-2 px-4 text-[#5e81ac] hover:bg-gray-700 rounded">projects</a>
  
            
          </div>
        
      </div>
    </div>
  </nav>

</div>



  
  
  <script>
    const hamburger = document.getElementById("hamburger");
    const bars = [document.getElementById("bar1"), document.getElementById("bar2"), document.getElementById("bar3")];
    const mobileMenu = document.getElementById("mobileMenu");
  
    hamburger.addEventListener("click", () => {
      
      mobileMenu.classList.toggle("hidden");
  
      
      bars[0].classList.toggle("rotate-45", mobileMenu.classList.contains("hidden"));
      bars[1].classList.toggle("opacity-0", mobileMenu.classList.contains("hidden"));
      bars[2].classList.toggle("rotate-135", mobileMenu.classList.contains("hidden"));
    });
  </script>
  
  
  </header>
  <div class="relative flex flex-col grow">
    <main class="grow">
      <article>
        <div id="hero" class="h-[150px] md:h-[200px]"></div>
        
       
        
        <header class="mt-5 max-w-prose">
          <h1 class="mt-0 text-4xl font-extrabold text-[#5e81ac] dark:text-neutral">Route Selection</h1>
          <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
            <div class="flex flex-row flex-wrap items-center">
              
              
              <time datetime="2024-12-01T09:15:27-05:00">December 1, 2024</time> 
              <span class="px-2 text-primary-500">.</span>
              <span>2122 words</span>
              <span class="px-2 text-primary-500">.</span>
              <span>10 minutes</span>
            </div>
            <div class="flex flex-row flex-wrap items-center">
              
              


            </div>
          </div>
          
          <div class="flex author">
             
            
            <img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width="96" height="96"
            alt="ngeranio a.k.a nikos" src="/author/avatar.png" />
    
            <div class="place-self-center">
              <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div>
              <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">ngeranio a.k.a nikos</div>
              <div class="text-2xl sm:text-lg"></div>
            </div>
          </div>
          <div class="mb-5"></div>
        </header>

        
        <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
        
        <div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
          <div class=" ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]">
            <div class="mt-0 overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
                <div class="min-w-[220px] py-2 border-dotted list-none  ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600 text-sm">
                  <nav id="TableOfContents">
  <ul>
    <li><a href="#best-path-selection">Best Path Selection</a></li>
    <li><a href="#lowest-route-preference">Lowest Route Preference</a></li>
    <li><a href="#highest-local-preference">Highest Local Preference</a></li>
    <li><a href="#shortest-as-path">Shortest AS Path</a></li>
    <li><a href="#lowest-origin">Lowest Origin</a></li>
    <li><a href="#lowest-med">Lowest MED</a></li>
    <li><a href="#route-type">Route Type</a></li>
    <li><a href="#lowest-igp-cost">Lowest IGP cost</a></li>
    <li><a href="#lowest-r-id-or-oldest-active">Lowest R-ID or Oldest Active</a></li>
    <li><a href="#cluster-list">Cluster List</a></li>
    <li><a href="#lowest-peer-ip">Lowest Peer IP</a></li>
  </ul>
</nav>
                </div>
            </div>
          </div>
        </div>
        
      <div class="min-w-0 min-h-0 max-w-fit">
        <div class="article-content max-w-prose mb-20 prose-h3:text-[#5e81ac]">
           
        <blockquote>
<p>Before the router even starts the route selection process it needs to make sure that the route is valid, checks the <strong>Martian</strong> routes, <strong>AS loops</strong> and <strong>next-hop reachability</strong>.</p>
</blockquote>
<h2 id="best-path-selection">Best Path Selection</h2>
<table>
  <thead>
      <tr>
          <th style="text-align: left">Attribute</th>
          <th style="text-align: left">Preference</th>
          <th style="text-align: left">Default Behavior</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">1. Route Preference</td>
          <td style="text-align: left">Lowest</td>
          <td style="text-align: left">Default value is 170</td>
      </tr>
      <tr>
          <td style="text-align: left">2. Local Preference</td>
          <td style="text-align: left">Highest</td>
          <td style="text-align: left">Default learned value is 100</td>
      </tr>
      <tr>
          <td style="text-align: left">3. AS-Path</td>
          <td style="text-align: left">Shortest</td>
          <td style="text-align: left">Usualy the first time route selection occurs</td>
      </tr>
      <tr>
          <td style="text-align: left">4. Origin</td>
          <td style="text-align: left">Lowest</td>
          <td style="text-align: left">IGP (I) &gt;  EGP (E), EGP &gt; incomplete (?)</td>
      </tr>
      <tr>
          <td style="text-align: left">5. Multi Exit Discriminator (MED)</td>
          <td style="text-align: left">Lowest</td>
          <td style="text-align: left">Compared when routes are learned from the same AS</td>
      </tr>
      <tr>
          <td style="text-align: left">6. Route Type</td>
          <td style="text-align: left">External</td>
          <td style="text-align: left">Internal vs External, External prefered</td>
      </tr>
      <tr>
          <td style="text-align: left">7. IGP Cost</td>
          <td style="text-align: left">Lowest</td>
          <td style="text-align: left">lowest cost towards the BGP next-hop</td>
      </tr>
      <tr>
          <td style="text-align: left">8. Internal vs External</td>
          <td style="text-align: left">Lowest</td>
          <td style="text-align: left">Lowest R-ID,  Oldest active route</td>
      </tr>
      <tr>
          <td style="text-align: left">10. Cluster List</td>
          <td style="text-align: left">Shortest</td>
          <td style="text-align: left">When route reflection is used</td>
      </tr>
      <tr>
          <td style="text-align: left">11. Peer IP Address</td>
          <td style="text-align: left">Lowest</td>
          <td style="text-align: left">Multiple peerings between the same router</td>
      </tr>
  </tbody>
</table>
<blockquote>
<p>For JUNOS the route selection results and criteria can be seen in the output of:</p>
</blockquote>
<ul>
<li><strong>show route details</strong></li>
<li><strong>show route extensive</strong></li>
</ul>
<h2 id="lowest-route-preference">Lowest Route Preference</h2>
<p>The Juniper default BGP preference is 170 below you can see a route selection which is based on a non-default route preference of 160.
Junos OS is kind enough to tell us why the second route has lost in the route selection.</p>
<blockquote>
<p>The Inactive Reason is <strong>Route Preference</strong></p>
</blockquote>
<pre tabindex="0"><code>jcluser@vMX4# run show route 192.168.250.0/24 exact detail       

inet.0: 14 destinations, 15 routes (14 active,0 holddown,0 hidden)
192.168.250.0/24 (2 entries, 1 announced)
        *BGP    Preference: 160/-101
                Next hop type: Router, Next hop index: 595
                Address: 0xc4b5f5c
                Next-hop reference count: 2
                Source: 10.100.34.1
                Next hop: 10.100.34.1 via ge-0/0/1.0,selected
                Session Id: 0x141
                State: &lt;Active Ext&gt;
                Local AS: 64533 Peer AS: 64522
                Age: 7 
                Validation State: unverified
                Task: BGP_64522.10.100.34.1
                Announcement bits(2):0-KRT 4-BGP_RT_Background
                AS path: 64522 I 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.3
                Thread: junos-main 
         BGP    Preference: 170/-101
                Next hop type: Router,Next hop index: 596
                Address: 0xc4b5ef4
                Next-hop reference count: 1
                Source: 10.100.24.1
                Next hop: 10.100.24.1 via ge-0/0/0.0,selected
                Session Id: 0x140
                State: &lt;Ext&gt;
                Inactive reason: Route Preference
                Local AS: 64533 Peer AS: 64522
                Age: 9:18 
                Validation State: unverified 
                Task: BGP_64522.10.100.24.1
                AS path: 64522 I 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.2
                Thread: junos-main 
</code></pre><h2 id="highest-local-preference">Highest Local Preference</h2>
<p>The default BGP <strong>Local Preference</strong> is 100 the route below has been selected for its higher non-default value of <strong>200</strong>.</p>
<blockquote>
<p>The Inactive Reason is <strong>Local Preference</strong></p>
</blockquote>
<pre tabindex="0"><code>jcluser@vMX4# run show route 192.168.250.0/24 exact detail 

inet.0: 14 destinations, 15 routes (14 active, 0 holddown, 0 hidden)
192.168.250.0/24 (2 entries, 1 announced)
        *BGP    Preference: 170/-201
                Next hop type: Router, Next hop index: 595
                Address: 0xc4b5f5c
                Next-hop reference count: 2
                Source: 10.100.34.1
                Next hop: 10.100.34.1 via ge-0/0/1.0, selected
                Session Id: 0x141
                State: &lt;Active Ext&gt;
                Local AS: 64533 Peer AS: 64522
                Age: 24 
                Validation State: unverified 
                Task: BGP_64522.10.100.34.1
                Announcement bits (2): 0-KRT 4-BGP_RT_Background 
                AS path: 64522 I 
                Accepted
                Localpref: 200
                Router ID: 10.100.100.3
                Thread: junos-main 
         BGP    Preference: 170/-101
                Next hop type: Router, Next hop index: 596
                Address: 0xc4b5ef4
                Next-hop reference count: 1
                Source: 10.100.24.1
                Next hop: 10.100.24.1 via ge-0/0/0.0, selected
                Session Id: 0x140
                State: &lt;Ext&gt;
                Inactive reason: Local Preference
                Local AS: 64533 Peer AS: 64522
                Age: 51:52 
                Validation State: unverified 
                Task: BGP_64522.10.100.24.1
                AS path: 64522 I 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.2
                Thread: junos-main 
</code></pre><h2 id="shortest-as-path">Shortest AS Path</h2>
<p>The route below has been selected because of its shortest AS Path.<br>
The selected route has 1 AS vs 5 AS.</p>
<blockquote>
<p>The Inactive Reason is <strong>AS Path</strong></p>
</blockquote>
<pre tabindex="0"><code>jcluser@vMX4# run show route 192.168.250.0/24 exact detail 

inet.0: 14 destinations, 15 routes (14 active, 0 holddown, 0 hidden)
192.168.250.0/24 (2 entries, 1 announced)
        *BGP    Preference: 170/-101
                Next hop type: Router, Next hop index: 596
                Address: 0xc4b5ef4
                Next-hop reference count: 2
                Source: 10.100.24.1
                Next hop: 10.100.24.1 via ge-0/0/0.0, selected
                Session Id: 0x140
                State: &lt;Active Ext&gt;
                Local AS: 64533 Peer AS: 64522
                Age: 1:23:04 
                Validation State: unverified 
                Task: BGP_64522.10.100.24.1
                Announcement bits (2): 0-KRT 4-BGP_RT_Background 
                AS path: 64522 I 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.2
                Thread: junos-main 
         BGP    Preference: 170/-101
                Next hop type: Router, Next hop index: 595
                Address: 0xc4b5f5c
                Next-hop reference count: 1
                Source: 10.100.34.1
                Next hop: 10.100.34.1 via ge-0/0/1.0, selected
                Session Id: 0x141
                State: &lt;Ext&gt;
                Inactive reason: AS path
                Local AS: 64533 Peer AS: 64522
                Age: 15 
                Validation State: unverified 
                Task: BGP_64522.10.100.34.1
                AS path: 64522 64522 64522 64522 64522 I 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.3
                Thread: junos-main 
</code></pre><h2 id="lowest-origin">Lowest Origin</h2>
<p>The active route is chosen based on its lower origin setting of I (IGP), compared to the second route which has an origin of ? (Incomplete).</p>
<blockquote>
<p>The inactive reason is <strong>Origin</strong></p>
</blockquote>
<pre tabindex="0"><code>jcluser@vMX4# run show route 192.168.250.0/24 exact detail    

inet.0: 14 destinations, 15 routes (14 active, 0 holddown, 0 hidden)
192.168.250.0/24 (2 entries, 1 announced)
        *BGP    Preference: 170/-101
                Next hop type: Router, Next hop index: 596
                Address: 0xc4b5ef4
                Next-hop reference count: 2
                Source: 10.100.24.1
                Next hop: 10.100.24.1 via ge-0/0/0.0, selected
                Session Id: 0x140
                State: &lt;Active Ext&gt;
                Local AS: 64533 Peer AS: 64522
                Age: 1:45:36 
                Validation State: unverified 
                Task: BGP_64522.10.100.24.1
                Announcement bits (2): 0-KRT 4-BGP_RT_Background 
                AS path: 64522 I 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.2
                Thread: junos-main 
         BGP    Preference: 170/-101
                Next hop type: Router, Next hop index: 595
                Address: 0xc4b5f5c
                Next-hop reference count: 1
                Source: 10.100.34.1
                Next hop: 10.100.34.1 via ge-0/0/1.0, selected
                Session Id: 0x141
                State: &lt;Ext Changed&gt;
                Inactive reason: Origin
                Local AS: 64533 Peer AS: 64522
                Age: 10 
                Validation State: unverified 
                Task: BGP_64522.10.100.34.1
                AS path: 64522 ? 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.3
                Thread: junos-main 
</code></pre><h2 id="lowest-med">Lowest MED</h2>
<p>The active route has a MED value of 20 shown as metric in the output.<br>
The second route has a MED of 150.</p>
<blockquote>
<p>Inactive reason <strong>Not Best in its group - Route Metric or MED comparison</strong></p>
</blockquote>
<pre tabindex="0"><code>jjcluser@vMX4# run show route 192.168.250.0/24 exact detail       

inet.0: 14 destinations, 15 routes (14 active, 0 holddown, 0 hidden)
192.168.250.0/24 (2 entries, 1 announced)
        *BGP    Preference: 170/-101
                Next hop type: Router, Next hop index: 595
                Address: 0xc4b5f5c
                Next-hop reference count: 2
                Source: 10.100.34.1
                Next hop: 10.100.34.1 via ge-0/0/1.0, selected
                Session Id: 0x141
                State: &lt;Active Ext&gt;
                Local AS: 64533 Peer AS: 64522
                Age: 36:03 Metric: 20 
                Validation State: unverified 
                Task: BGP_64522.10.100.34.1
                Announcement bits (2): 0-KRT 4-BGP_RT_Background 
                AS path: 64522 I 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.3
                Thread: junos-main 
         BGP    Preference: 170/-101
                Next hop type: Router, Next hop index: 596
                Address: 0xc4b5ef4
                Next-hop reference count: 1
                Source: 10.100.24.1
                Next hop: 10.100.24.1 via ge-0/0/0.0, selected
                Session Id: 0x140
                State: &lt;NotBest Ext&gt;
                Inactive reason: Not Best in its group - 
                                 Route Metric or MED comparison
                Local AS: 64533 Peer AS: 64522
                Age: 13 Metric: 150 
                Validation State: unverified 
                Task: BGP_64522.10.100.24.1
                AS path: 64522 I 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.2
                Thread: junos-main
</code></pre><h2 id="route-type">Route Type</h2>
<p>The directly adverised external route is preferred over the external route learned via an internal neighbor.
This can be seen from the Local AS and Peer AS line.<br>
The <strong>Local AS</strong> and <strong>Peer AS</strong> line gives information on if the route is learned from an <br>
internal or external neighbor.<br>
The order of preference is:</p>
<ul>
<li>Local redistributed routes into BGP <strong>(Interior)</strong></li>
<li>External route directly learned from External BGP peers <strong>(Exterior)</strong></li>
<li>External route learned through an Internal BGP peer <strong>(Exterior via Interior)</strong></li>
</ul>
<blockquote>
<p>Inactive reason <strong>Interior &gt; Exterior &gt; Exterior via Interior</strong></p>
</blockquote>
<pre tabindex="0"><code>jcluser@vMX6# run show route 192.168.250.0/24 exact detail 

inet.0: 11 destinations, 12 routes (11 active, 0 holddown, 0 hidden)
192.168.250.0/24 (2 entries, 1 announced)
        *BGP    Preference: 170/-101
                Next hop type: Router, Next hop index: 587
                Address: 0xc4b5dbc
                Next-hop reference count: 2
                Source: 10.100.46.1
                Next hop: 10.100.46.1 via ge-0/0/3.0, selected
                Session Id: 0x141
                State: &lt;Active Ext&gt;
                Local AS: 64544 Peer AS: 64533
                Age: 50 
                Validation State: unverified 
                Task: BGP_64533.10.100.46.1
                Announcement bits (3):0-KRT 4-BGP_RT_Background 
                                     5-Resolve tree 1 
                AS path: 64533 I 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.4
                Thread: junos-main 
         BGP    Preference: 170/-101
                Next hop type: Indirect, Next hop index: 0
                Address: 0xc4b5d54
                Next-hop reference count: 1
                Source: 10.100.100.5
                Next hop type: Router, Next hop index: 349
                Next hop: 100.123.0.1 via fxp0.0, selected
                Session Id: 0x0
                Protocol next hop: 10.100.25.1
                Indirect next hop: 0xc61de84 338 INH Session ID: 0x0
                State: &lt;Int Ext&gt;
                Inactive reason: Interior &gt; 
                                 Exterior &gt; 
                                 Exterior via Interior
                Local AS: 64544 Peer AS: 64544
                Age: 6:58 Metric2: 0 
                Validation State: unverified 
                Task: BGP_64544.10.100.100.5
                AS path: 64522 I 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.5
                Thread: junos-main 
</code></pre><h2 id="lowest-igp-cost">Lowest IGP cost</h2>
<p>The active route is chosen based on the lowest IGP cost to the BGP next-hop, shown as protocol next-hop in the output. The IGP cost is shown as metric2 in the output. The active route has a metric2 of 5. The inactive route has a metric2 of 10. The inactive reason given is Not Best in its group - IGP metric</p>
<blockquote>
<p>Inactive reason <strong>Interior &gt; Exterior &gt; Exterior via Interior</strong></p>
</blockquote>
<pre tabindex="0"><code>jcluser@vMX4# run show route 192.168.252.0/24 exact detail    

inet.0: 16 destinations, 18 routes (16 active, 0 holddown, 0 hidden)
192.168.252.0/24 (2 entries, 1 announced)
        *BGP    Preference: 170/-101
                Next hop type: Router, Next hop index: 595
                Address: 0xc4b5f5c
                Next-hop reference count: 3
                Source: 10.100.34.1
                Next hop type: Router, Next hop index: 172342
                Next hop: 10.100.34.1 via ge-0/0/1.0, selected
                Next hop: 10.100.24.1 via ge-0/0/1.0 
                Session Id: 0x141
                State: &lt;Active Ext&gt;
                Local AS: 64533 Peer AS: 64522
                Age: 16:59  Metric2: 10
                Validation State: unverified 
                Task: BGP_64522.10.100.34.1
                Announcement bits (2): 0-KRT 4-BGP_RT_Background 
                AS path: 64522 64544 I 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.3
                Thread: junos-main 
         BGP    Preference: 170/-101
                Address: 0xc4b5fc4
                Next-hop reference count: 2
                Source: 10.100.24.1
                Next hop type: Router, Next hop index: 172342
                Next hop: 10.100.34.1 via ge-0/0/1.0, selected
                Next hop: 10.100.24.1 via ge-0/0/1.0 
                Session Id: 0x0
                State: &lt;NotBest Ext Changed&gt;
                Inactive reason: Not Best in its group - IGP metric
                Local AS: 64533 Peer AS: 64522
                Age: 16:59 Metric
                Validation State: unverified 
                Task: BGP_64522.10.100.24.1
                AS path: 64522 64544 I 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.2
                Thread: junos-main 
</code></pre><h2 id="lowest-r-id-or-oldest-active">Lowest R-ID or Oldest Active</h2>
<p>This step is different for internal sessions compared to external sessions. Examples of both I-BGP and E-BGP are shown below.</p>
<p>The first output shows the behavior for internal sessions. For internal sessions the lowest router-id is used as the tie-breaker. The inactive route has a router-id 192.168.2.2 which is higher than the 192.168.2.2 router-id of the active route. The inactive reason given is Not Best in its group - Router ID.</p>
<p>BGP Router ID</p>
<p>For external sessions the default behavior is to stay on the current active route for stability reasons. The inactive reason given in this scenario is Not Best in its group - Active preferred</p>
<pre tabindex="0"><code>jcluser@vMX4# run show route 192.168.252.0/24 exact detail 

inet.0: 16 destinations, 18 routes (16 active, 0 holddown, 0 hidden)
192.168.252.0/24 (2 entries, 1 announced)
        *BGP    Preference: 170/-101
                Next hop type: Router, Next hop index: 595
                Address: 0xc4b5f5c
                Next-hop reference count: 2
                Source: 10.100.34.1
                Next hop: 10.100.34.1 via ge-0/0/1.0, selected
                Session Id: 0x141
                State: &lt;Active Ext&gt;
                Local AS: 64533 Peer AS: 64522
                Age: 1:00 
                Validation State: unverified 
                Task: BGP_64522.10.100.34.1
                Announcement bits (2): 0-KRT 4-BGP_RT_Background 
                AS path: 64522 64544 I 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.3
                Thread: junos-main 
         BGP    Preference: 170/-101
                Next hop type: Router, Next hop index: 0
                Address: 0xc4b5fc4
                Next-hop reference count: 1
                Source: 10.100.24.1
                Next hop: 10.100.24.1 via ge-0/0/0.0, selected
                Session Id: 0x0
                State: &lt;NotBest Ext Changed&gt;
                Inactive reason: Not Best in its group - Active preferred
                Local AS: 64533 Peer AS: 64522
                Age: 1:00 
                Validation State: unverified 
                Task: BGP_64522.10.100.24.1
                AS path: 64522 64544 I 
                Accepted
                Localpref: 100
                Router ID: 10.100.100.2
                Thread: junos-main 
</code></pre><p>BGP E-BGP Oldest</p>
<p>The default behavior for external sessions can be changed using the path-selection external-router-id command. When this option is configured the external session will use the router-id as the tie-breaker (just like it does for internal sessions). The inactive reason given is Not Best in its group - Router ID.</p>
<p>BGP E-BGP Router id - external router-id</p>
<h2 id="cluster-list">Cluster List</h2>
<p>Only in the case of I-BGP learned routes and the use of route reflection will point 9 become a potential selection tie-breaker. The shortest cluster list will be preferred at this point, a missing cluster list is seen as a lenght of 0 so always preferred.</p>
<p>In the output below the active route has no cluster list whereas the inactive route has a cluster list length of 1 (192.168.2.1). The inactive reason given is Not Best in its group - Cluster list length</p>
<h2 id="lowest-peer-ip">Lowest Peer IP</h2>
<p>The ultimate tie-breaker is needed when 2 routers peer 2 or more times with each other. This is typically done for load-balancing purposes. The router-id in step 8 can&rsquo;t be used as it will be the same for all the peering sessions.</p>
<p>The active route has the lowest peer ip address, shown as Source in the output. The inactive reason given is Not Best in its group - Update source</p>
<p>The BGP multiple exit discriminator (MED, or MULTI_EXIT_DISC) is a non-transitive attribute, meaning that it is not propagated throughout the Internet, but only to adjacent autonomous systems (ASs). The MED attribute is optional, meaning that it is not always sent with the BGP updates. The purpose of MED is to influence how other ASs enter your AS to reach a certain prefix.</p>

         
        </div>
        
        <div class="flex justify-between">
  
  <div class="">
    
    <a
      href="http://localhost:1313/routing/bgp/fsm/?ref=footer"
      class="flex items-center justify-center px-3 h-8 me-3 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
    >
      <svg
        class="w-3.5 h-3.5 me-2 rtl:rotate-180"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 14 10"
      >
        <path
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M13 5H1m0 0 4 4M1 5l4-4"
        />
      </svg>
      Previous
    </a>
    
  </div>
  
  <div class="">
    
  </div>
</div>

      
      </div>
        </section>
      </article>
  
      </main>
  </div>
  <footer>
    <footer class="mx-auto w-full  max-w-container text-center" >
    
   <div class="max-w-screen-xl sm:pt-5 md:pt-8 pt-0">
       <div class="border-b border-[#4c566a] mb-5 flex justify-between"></div>
   </div> 
   <div class="flex flex-col items-center ">
       
       <div id="logo">
           <span class="text-[#5e81ac]">ngeran[</span><span class="text-[#ebcb8b]">io</span><span class="text-[#5e81ac]">]</span>
       </div>
       <p class="mt-5 text-center text-sm leading-6 text-slate-500">Â© Copyright 2024. All rights reserved.</p>
       <div class="mt-4 flex items-center justify-center space-x-4 text-sm font-semibold leading-6 text-slate-700"><a href="/privacy-policy">Privacy policy</a>
           <div class="h-4 w-px bg-slate-500/20"></div><a href="/changelog">Changelog</a>
       </div>
   </div>
</footer>
  </footer>
</body>
</html>

